{{ config(materialized='view') }}

with amazon_search_terms as 
(
    select * from {{ source('ha_amazon','amazon_search_terms') }}
),
final as
( 
select distinct
     --concat(isbn_13,'|"|~|"|',left(right(_file,10),6),'|"|~|"|"amazon"') as business_key
    cast(left(right(_file,10),6) as date) as search_terms_date
    --,isbn_13
    ,_file as record_source
    ,_fivetran_synced as dw_load_date_time
    ,search_frequency_rank
    ,search_term
    -- ,_1_clicked_asin 
    -- ,_1_click_share
    -- ,_1_conversion_share 
    -- ,_1_product_title
    -- ,_2_clicked_asin
    -- ,_2_click_share
    -- ,_2_conversion_share
    -- ,_2_product_title
    -- ,_3_clicked_asin
    -- ,_3_click_share
    -- ,_3_conversion_share
    -- ,_3_product_title
from amazon_search_terms
where 
--isbn_13 <> '0'
-- and isbn_13 <> 'UNKNOWN'
-- and isbn_13 <> 'EISBN'
-- and isbn_13 <> 'ISBN-13'
 reporting_range = 'Daily'
) 
select * 
from final



